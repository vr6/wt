var $jscomp={scope:{},checkStringArgs:function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""}};
$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,a,"startsWith");a+="";for(var e=b.length,g=a.length,h=Math.max(0,Math.min(c|0,b.length)),f=0;f<g&&h<e;)if(b[h++]!=a[f++])return!1;return f>=g}},"es6-impl","es3");
var scope={sz:50,uinfoedit:!1,cmtloaded:!1,pagereset:!1,page:1,filter:"",qtxt:"",qname:"",qpk:0,cset:{},uid:null,uadmin:!1,topic:"2",typing:!1,uinfo:{},userlen:"0",utyping:"",cmd:{connect:"/connect ",disconnect:"/disconnect ",broadcast:"/broadcast "},statusopts:";RFE;RFE Resp Sent;Received;Approved;Name Updated;Other".split(";"),getstatusopts:function(){return scope.statusopts[this.status]},getstatusopts2:function(){return scope.statusopts[scope.uinfo.status]},getclass:{cmt:function(){return 1==this.type?
"cmt cmt1":this.owner?"cmt cmt2":"cmt"},stbar:function(){return 1==this.type?"stbar stbar1":this.owner?"stbar stbar2":"stbar"}},getval:{timeago:function(){return getago(this.cmt_dt)},qtxt:function(){return 0==this.topic?"...":this.qtxt},cmttxt:function(){return 0==this.topic?"[deleted]":this.txt},pgof:function(){return""+(scope.page-1)*scope.sz+" - "+((scope.page-1)*scope.sz+scope.cset.cmts.length)+" (of "+scope.cset.total+")"}},getshow:{recent:function(){return 1<scope.page},older:function(){return scope.page<
scope.cset.total/scope.sz},modcmt:function(){return!this.owner&&scope.uadmin&&1!=this.type},rmcmt:function(){return this.owner},cmtlist:function(){return null!=scope.cset.cmts&&0<scope.cset.cmts.length}}},templatedata=null;
$(document).ready(function(){scope.pagereset=!1;checkadmin();scope.uid=store.getStr("wt_id");scope.uinfo.name=store.getStr("wt_name");scope.uinfo.status=store.getInt("wt_status");scope.uinfo.series=store.getStr("wt_series");$.get("cmtlist.html",function(a){templatedata=a;scope.filter=store.getStr("wt_fltr");renderCmtForm();loadcomments()})});$(document).on("click",function(){$("#epop").hide()});
function loadcomments(){scope.cmtloaded=!1;scope.uid||(scope.uid=guid(),store.setStr("wt_id",scope.uid));var a=store.getInt("wt_page");1>a&&(a=1,store.setInt("wt_page",a));var b=store.getStr("wt_fltr");b?$.post("/api/data/comments?action=filter&topic="+scope.topic+"&u="+scope.uid+"&p="+a+"&sz="+scope.sz,JSON.stringify({tags:b}),function(b){scope.cset=b;scope.page=a;scope.cmtloaded=!0;if(scope.cset.cmts)for(b=0;b<scope.cset.cmts.length;b++)scope.cset.cmts[b].cindex=b;renderCmtForm();renderCmtListBody()},
"json"):(scope.cmtloaded=!1,$.getJSON("/api/data/comments?topic="+scope.topic+"&u="+scope.uid+"&p="+a+"&sz="+scope.sz,function(b){scope.cset=b;scope.page=a;scope.cmtloaded=!0;if(scope.cset.cmts)for(b=0;b<scope.cset.cmts.length;b++)scope.cset.cmts[b].cindex=b;renderCmtForm();renderCmtListBody()}))}function getrecent(){var a=store.getInt("wt_page");1<a&&(store.setInt("wt_page",a-1),refresh())}function getprev(){var a=store.getInt("wt_page");store.setInt("wt_page",a+1);refresh()}
function resetcmts(){store.setInt("wt_page",1);store.setStr("wt_fltr",null);scope.pagereset=!0;renderCmtForm();refresh()}function filtercmts(){var a=$("#fltrbox").val().trim();store.setInt("wt_page",1);store.setStr("wt_fltr",a);refresh()}function refresh(){window.location.href="/msg.html"}function guid(){return Math.random().toString(36).substring(2,8)+Math.random().toString(36).substring(2,8)}function blank(a){return a?a.trim():""}function dash(a){return a?a:" - "}
var store={getInt:function(a){return(a=localStorage.getItem(a))?parseInt(a):-1},getStr:function(a){return(a=localStorage.getItem(a))?a:""},getFlag:function(a){return"1"==localStorage.getItem(a)?!0:!1},setInt:function(a,b){localStorage.setItem(a,""+b)},setStr:function(a,b){localStorage.setItem(a,b?b:"")},setFlag:function(a,b){localStorage.setItem(a,b?"1":"0")}};
function renderCmtForm(){var a=$(templatedata).filter("#CmtFormTpl").html(),a=Mustache.to_html(a,scope);$("#CmtFormDiv").html(a);scope.uinfo.status&&$("#ustatusbox option[value="+scope.uinfo.status+"]").prop("selected",!0);$("#emoji").click(function(a){console.log("epop");a.stopPropagation();$("#epop").slideToggle("fast")});$("#epop span").on("click",function(a){var b=$("#cmtbox");b.val(b.val()+a.target.innerText)})}
function renderCmtListBody(){var a=$(templatedata).filter("#CmtListBodyTpl").html(),b={cmtItem:$(templatedata).filter("#CmtTpl").html()},a=Mustache.to_html(a,scope,b);$("#CmtListBodyDiv").html(a)}function edituinfo(){scope.uinfoedit=!0;renderCmtForm()}function canceluinfo(){scope.uinfoedit=!1;renderCmtForm()}
function saveuinfo(){scope.uinfo.name=$("#unamebox").val();store.setStr("wt_name",blank(scope.uinfo.name));scope.uinfo.status=$("#ustatusbox").val();store.setStr("wt_status",scope.uinfo.status);scope.uinfo.series=$("#useriesbox").val();store.setStr("wt_series",blank(scope.uinfo.series));scope.uinfoedit=!1;var a=store.getStr("wt_id");a||(a=guid(),store.setStr("wt_id",a));scope.uinfo.id=a;$.post("/api/data/comments?action=uinfo",JSON.stringify(scope.uinfo),function(a){},"json");renderCmtForm()}
function closeqtxt(){scope.qtxt=null;scope.qname=null;scope.qpk=0;$("#qtxtdiv").hide();$("#cmtbox").focus()}
function addcomment(){if(scope.uinfo.name){var a=store.getStr("wt_id");a||(a=guid(),store.setStr("wt_id",a));var b=$("#cmtbox").val();b&&(a={user:a,name:scope.uinfo.name,topic:scope.topic,txt:b},scope.qtxt&&(a.qtxt=300>scope.qtxt.length?scope.qtxt:scope.qtxt.substring(0,297)+"...",a.qname=scope.qname,a.qpk=scope.qpk),$("#cmtbox").val(""),ontyping(),$.post("/api/data/comments",JSON.stringify(a),function(a){chatclient.sendMessage(a);var b=store.getStr("wt_cmts"),b=b?JSON.parse(b):[];scope.qtxt="";b.push(parseInt(a.pk));
store.setStr("wt_cmts",JSON.stringify(b));renderCmtForm()},"json"))}else alert("Please provide your name and other info by clicking on 'edit' below and please save it before proceeding with comment")}function replycmt(a){a=scope.cset.cmts[a];console.log("pk="+a.pk);scope.qtxt=a.txt;scope.qname=a.name;scope.qpk=a.pk;renderCmtForm();$("html, body").animate({scrollTop:$("#cmtsection").offset().top},1E3);$("#cmtbox").focus()}
function upvote(a){var b=scope.cset.cmts[a];if(!b.owner){var c=store.getStr("wt_votes"),c=c?JSON.parse(c):[];-1==c.indexOf(b.pk)&&(b.votes++,$("#votes"+a).text(b.votes),c.push(b.pk),store.setStr("wt_votes",JSON.stringify(c)),$.post("/api/data/comments?action=upvote",""+b.pk,function(a){},"json"))}}
function modcmt(a){if(confirm("The comment text will be replaced by '[deleted]'. Are you sure to mod this comment?")){a=scope.cset.cmts[a];var b=store.getStr("wt_id");b&&$.post("/api/data/comments?action=mod",JSON.stringify({pk:a.pk,user:b}),function(a){loadcomments()},"json")}}
function rmcmt(a){if(confirm("Are you sure to delete this comment?")){a=scope.cset.cmts[a];var b=store.getStr("wt_id");b&&$.post("/api/data/comments?action=del",JSON.stringify({pk:a.pk,user:b}),function(a){loadcomments()},"json")}}function checkadmin(){$.getJSON("/api/user/test?a=checkadmin&id="+store.getStr("wt_id"),function(a){scope.uadmin="success"==a.status})}
function getago(a){if(void 0==a)return"";var b=a.split(" ");a=b[0].split("-");b=b[1].split(":");a=new Date(parseInt(a[0]),parseInt(a[1])-1,parseInt(a[2]),parseInt(b[0]),parseInt(b[1]),parseInt(b[2]));a.setTime(a.getTime()-6E4*a.getTimezoneOffset());a=Math.floor((new Date-a)/1E3);return 31536E3<=a?(a=Math.floor(a/31536E3),a+(1<a?" years":" year")):2592E3<=a?(a=Math.floor(a/2592E3),a+(1<a?" months":" month")):86400<=a?(a=Math.floor(a/86400),a+(1<a?" days":" day")):3600<=a?(a=Math.floor(a/3600),a+(1<
a?" hrs":" hr")):60<=a?(a=Math.floor(a/60),a+" min"):a+" sec"}function links2html(a){return a.replace(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig,"<a href='$1' target=\"_blank\">$1</a>")}
var chatclient={socket:null,userlen:null,init:function(a){socket=new WebSocket("wss://worktheme.com/");socket.onopen=function(){socket.send(scope.cmd.connect+a)};socket.onmessage=function(a){a=a.data;if(a.startsWith("$$users:")){var b=document.getElementById("userlen");b&&(b.innerText="online: "+a.substring(8))}else if(a.startsWith("$$ty:")){var d=JSON.parse(a.substring(5));if(b=document.getElementById("utyping"))b.innerText=7<a.length?"typing: "+d.join(", "):""}else{store.getStr("wt_id");a=JSON.parse(a);
b=(b=store.getStr("wt_cmts"))?JSON.parse(b):[];for(d=b.length-1;0<=d;d--)if(b[d]==a.pk){a.owner=!0;break}scope.cset.cmts.unshift(a);renderCmtListBody()}};socket.onclose=function(){}},sendMessage:function(a){socket.send(scope.cmd.broadcast+JSON.stringify(a))},addTyping:function(){socket.send("/ty1 "+scope.uinfo.name)},removeTyping:function(){socket.send("/ty2 "+scope.uinfo.name)},close:function(){socket.close()}};scope.typing=!1;
function ontyping(){$("#cmtbox").val()?scope.typing||(chatclient.addTyping(),scope.typing=!0):scope.typing&&(chatclient.removeTyping(),scope.typing=!1)}chatclient.init(scope.uinfo.name);function disconnect(){chatclient.close()};
